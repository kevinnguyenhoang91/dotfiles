session_name: devops
start_directory: /Users/khanh/Projects
# before_script: ./scripts/poetry-before-script.sh
# shell_command_before:
#   - poetry install --no-interaction --no-ansi --quiet
#   - source $(poetry env info -p)/bin/activate; reset
windows:
  - focus: "true"
    layout: main-horizontal
    panes:
      - focus: "true"
        shell_command:
          - nvim -c 'lua require("persistence").load()'
      - shell_command:
          - devcontainer up --workspace-folder . && devcontainer exec --workspace-folder . zsh
    start_directory: ./ghn-iac
    window_name: ghn-iac
    options:
      main-pane-height: 75%
  - layout: main-horizontal
    panes:
      - focus: "true"
        shell_command:
          - nvim -c 'lua require("persistence").load()'
    start_directory: ./devops-gitlab-cicd
    window_name: devops-gitlab-cicd
    options:
      main-pane-height: 75%
  # - layout: main-horizontal
  #   panes:
  #     - focus: "true"
  #       shell_command:
  #         - nvim -c 'lua require("persistence").load()'
  #   start_directory: ./platform-gitlab-cicd
  #   window_name: platform-gitlab-cicd
  #   options:
  #     main-pane-height: 75%
  # - layout: main-horizontal
  #   panes:
  #     - focus: "true"
  #       shell_command:
  #         - nvim -c 'lua require("persistence").load()'
  #   start_directory: ./gitlab-ci-image
  #   window_name: gitlab-ci-image
  #   options:
  #     main-pane-height: 75%
  # - layout: main-horizontal
  #   panes:
  #     - focus: "true"
  #       shell_command:
  #         - devcontainer up --workspace-folder . && devcontainer exec --workspace-folder . zsh
  #   start_directory: ./ghn-iac
  #   window_name: ghn-iac (devcontainer)
  #   options:
  #     main-pane-height: 75%
  - layout: main-horizontal
    panes:
      - focus: "true"
        shell_command:
          - read "response?Enter SSH? (y/n) " && [[ "$response" == [Yy] ]] && gcloud compute ssh --zone "asia-southeast1-b" "gitlab-backup-v1-20241219-045315" --project "ghn-tech"
    start_directory: ./
    window_name: SSH Gitlab GHN backup
    options:
      main-pane-height: 75%
  - layout: main-horizontal
    panes:
      - focus: "true"
        shell_command:
          - read "response?Enter SSH? (y/n) " && [[ "$response" == [Yy] ]] && gcloud compute ssh --zone "asia-southeast1-b" "ghnex-gitlab" --project "ghn-tech"
    start_directory: ./
    window_name: SSH Gitlab GHN production
    options:
      main-pane-height: 75%
  # - layout: main-horizontal
  #   panes:
  #     - focus: "true"
  #       shell_command:
  #         - devcontainer up --workspace-folder . && devcontainer exec --workspace-folder . zsh
  #   start_directory: ./ghn-backstage
  #   window_name: ghn-backstage (devcontainer)
  #   options:
  #     main-pane-height: 75%
  - layout: main-horizontal
    panes:
      - focus: "true"
        shell_command:
          - nvim -c 'lua require("persistence").load()'
      - shell_command:
          - read "response?Stop and start devcontainer? (y/n) " && [[ "$response" == [Yy] ]] && docker ps --format "{{.ID}} {{.Image}}" | grep "vsc-ghn-backstage" | awk '{print $1}' | xargs docker stop && devcontainer up --workspace-folder . --overrideConfig .devcontainer/devcontainer.cli.json && devcontainer exec --workspace-folder . --overrideConfig .devcontainer/devcontainer.cli.json zsh -c "echo 'y' | yarn install && yarn dev"
      - shell_command:
          - read "response?Enter devcontainer's shell? (y/n) " && [[ "$response" == [Yy] ]] && devcontainer exec --workspace-folder . --overrideConfig .devcontainer/devcontainer.cli.json zsh
      - shell_command:
          - lzd
    start_directory: ./ghn-backstage
    window_name: ghn-backstage
    options:
      main-pane-height: 75%
